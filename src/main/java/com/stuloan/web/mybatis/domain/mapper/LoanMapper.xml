<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.stuloan.web.mybatis.domain.inte.LoanMapper">
  <resultMap id="BaseResultMap" type="com.stuloan.web.mybatis.domain.Loan">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <constructor>
      <idArg column="id" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="userid" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="loanamount" javaType="java.lang.Double" jdbcType="DECIMAL" />
      <arg column="isstage" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="repayreal" javaType="java.lang.Double" jdbcType="DECIMAL" />
      <arg column="stagenum" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="repayyet" javaType="java.lang.Double" jdbcType="DECIMAL" />
      <arg column="stagenumyet" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="createdate" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="updatedate" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="state" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="auditid" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="auditman" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="auditdate" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="auditmsg" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="remark" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="loanpurpose" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="loanage" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="ispayoff" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="orderno" javaType="java.lang.String" jdbcType="VARCHAR" />
    </constructor>
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, userid, loanamount, isstage, repayreal, stagenum, repayyet, stagenumyet, createdate, 
    updatedate, state, auditid, auditman, auditdate, auditmsg, remark, loanpurpose, loanage, ispayoff, orderno
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from loan
    where id = #{id,jdbcType=VARCHAR}
  </select>

  <select id="selectByParams" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from loan
    where 1=1
    <if test="id != null and id != ''">
      and id = #{id,jdbcType=VARCHAR}
    </if>
    <if test="userid != null and userid != ''">
      and userid = #{userid,jdbcType=VARCHAR}
    </if>
    <if test="state != null and state != ''">
      and state = #{state,jdbcType=CHAR}
    </if>
    <if test="orderno != null and orderno != ''">
      and orderno = #{orderno,jdbcType=VARCHAR}
    </if>
    <if test="orderby != null and orderby != ''">
      order by ${orderby}
    </if>
    <if test="beginRow != null and beginRow != ''">
      limit ${beginRow},${pageSize}
    </if>
  </select>

  <select id="selectByParams02" parameterType="java.lang.String" resultType="java.util.Map">
    select
    a.*,b.stuname
    from loan a
    left join studentinfo b on b.userid=a.userid
    where 1=1
    <if test="id != null and id != ''">
      and a.id = #{id,jdbcType=VARCHAR}
    </if>
    <if test="userid != null and userid != ''">
      and a.userid = #{userid,jdbcType=VARCHAR}
    </if>
    <if test="state != null and state != ''">
      and state = #{state,jdbcType=CHAR}
    </if>
    <if test="orderby != null and orderby != ''">
      order by ${orderby}
    </if>
    <if test="beginRow != null and beginRow != ''">
      limit ${beginRow},${pageSize}
    </if>
  </select>

  <select id="selectCountByParams" parameterType="java.util.Map" resultType="java.lang.Integer">
    select
    count(id) as total
    from loan
    where 1=1
    <if test="id != null and id != ''">
      and id = #{id,jdbcType=VARCHAR}
    </if>
    <if test="state != null and state != ''">
      and state = #{state,jdbcType=CHAR}
    </if>
  </select>

  <select id="selectloanexpires" parameterType="java.util.Map" resultType="java.util.Map">
    select t1.id
    ,t3.stuname,t4.username,t4.phone,DATE_FORMAT(t1.repaydateplan,'%Y-%m-%d') as expiretime
    from repaydetail t1
    left join loan t2 on t2.id=t1.loanid
    left join studentinfo t3 on t3.userid=t2.userid
    left join sysuser t4 on t4.id=t3.userid
    where t1.repaydateplan &lt;= #{searchdate} and issendmsg <![CDATA[!= ]]> '1'
    <if test="limit != null and limit != ''">
      limit ${limit}
    </if>
  </select>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from loan
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.stuloan.web.mybatis.domain.Loan">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into loan (id, userid, loanamount, 
      isstage, repayreal, stagenum, 
      repayyet, stagenumyet, createdate, 
      updatedate, state, auditid, 
      auditman, auditdate, auditmsg, 
      remark, loanpurpose, loanage, ispayoff, orderno
      )
    values (#{id,jdbcType=VARCHAR}, #{userid,jdbcType=VARCHAR}, #{loanamount,jdbcType=DECIMAL}, 
      #{isstage,jdbcType=CHAR}, #{repayreal,jdbcType=DECIMAL}, #{stagenum,jdbcType=INTEGER}, 
      #{repayyet,jdbcType=DECIMAL}, #{stagenumyet,jdbcType=INTEGER}, #{createdate,jdbcType=TIMESTAMP},
      #{updatedate,jdbcType=TIMESTAMP}, #{state,jdbcType=CHAR}, #{auditid,jdbcType=VARCHAR},
      #{auditman,jdbcType=VARCHAR}, #{auditdate,jdbcType=TIMESTAMP}, #{auditmsg,jdbcType=VARCHAR},
      #{remark,jdbcType=VARCHAR}, #{loanpurpose,jdbcType=VARCHAR}, #{loanage,jdbcType=INTEGER}
      , #{ispayoff,jdbcType=CHAR}, #{orderno,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.stuloan.web.mybatis.domain.Loan">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into loan
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="userid != null">
        userid,
      </if>
      <if test="loanamount != null">
        loanamount,
      </if>
      <if test="isstage != null">
        isstage,
      </if>
      <if test="repayreal != null">
        repayreal,
      </if>
      <if test="stagenum != null">
        stagenum,
      </if>
      <if test="repayyet != null">
        repayyet,
      </if>
      <if test="stagenumyet != null">
        stagenumyet,
      </if>
      <if test="createdate != null">
        createdate,
      </if>
      <if test="updatedate != null">
        updatedate,
      </if>
      <if test="state != null">
        state,
      </if>
      <if test="auditid != null">
        auditid,
      </if>
      <if test="auditman != null">
        auditman,
      </if>
      <if test="auditdate != null">
        auditdate,
      </if>
      <if test="auditmsg != null">
        auditmsg,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="loanpurpose != null">
        loanpurpose,
      </if>
      <if test="loanage != null">
        loanage,
      </if>
      <if test="ispayoff != null">
        ispayoff,
      </if>
      <if test="orderno != null">
        orderno
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="userid != null">
        #{userid,jdbcType=VARCHAR},
      </if>
      <if test="loanamount != null">
        #{loanamount,jdbcType=DECIMAL},
      </if>
      <if test="isstage != null">
        #{isstage,jdbcType=CHAR},
      </if>
      <if test="repayreal != null">
        #{repayreal,jdbcType=DECIMAL},
      </if>
      <if test="stagenum != null">
        #{stagenum,jdbcType=INTEGER},
      </if>
      <if test="repayyet != null">
        #{repayyet,jdbcType=DECIMAL},
      </if>
      <if test="stagenumyet != null">
        #{stagenumyet,jdbcType=INTEGER},
      </if>
      <if test="createdate != null">
        #{createdate,jdbcType=TIMESTAMP},
      </if>
      <if test="updatedate != null">
        #{updatedate,jdbcType=TIMESTAMP},
      </if>
      <if test="state != null">
        #{state,jdbcType=CHAR},
      </if>
      <if test="auditid != null">
        #{auditid,jdbcType=VARCHAR},
      </if>
      <if test="auditman != null">
        #{auditman,jdbcType=VARCHAR},
      </if>
      <if test="auditdate != null">
        #{auditdate,jdbcType=TIMESTAMP},
      </if>
      <if test="auditmsg != null">
        #{auditmsg,jdbcType=VARCHAR},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="loanpurpose != null">
        #{loanpurpose,jdbcType=VARCHAR},
      </if>
      <if test="loanage != null">
        #{loanage,jdbcType=INTEGER},
      </if>
      <if test="ispayoff != null">
        #{ispayoff,jdbcType=CHAR},
      </if>
      <if test="orderno != null">
        #{orderno,jdbcType=VARCHAR}
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.stuloan.web.mybatis.domain.Loan">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update loan
    <set>
      <if test="userid != null">
        userid = #{userid,jdbcType=VARCHAR},
      </if>
      <if test="loanamount != null">
        loanamount = #{loanamount,jdbcType=DECIMAL},
      </if>
      <if test="isstage != null">
        isstage = #{isstage,jdbcType=CHAR},
      </if>
      <if test="repayreal != null">
        repayreal = #{repayreal,jdbcType=DECIMAL},
      </if>
      <if test="stagenum != null">
        stagenum = #{stagenum,jdbcType=INTEGER},
      </if>
      <if test="repayyet != null">
        repayyet = #{repayyet,jdbcType=DECIMAL},
      </if>
      <if test="stagenumyet != null">
        stagenumyet = #{stagenumyet,jdbcType=INTEGER},
      </if>
      <if test="createdate != null">
        createdate = #{createdate,jdbcType=TIMESTAMP},
      </if>
      <if test="updatedate != null">
        updatedate = #{updatedate,jdbcType=TIMESTAMP},
      </if>
      <if test="state != null">
        state = #{state,jdbcType=CHAR},
      </if>
      <if test="auditid != null">
        auditid = #{auditid,jdbcType=VARCHAR},
      </if>
      <if test="auditman != null">
        auditman = #{auditman,jdbcType=VARCHAR},
      </if>
      <if test="auditdate != null">
        auditdate = #{auditdate,jdbcType=TIMESTAMP},
      </if>
      <if test="auditmsg != null">
        auditmsg = #{auditmsg,jdbcType=VARCHAR},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="loanpurpose != null">
        loanpurpose = #{loanpurpose,jdbcType=VARCHAR},
      </if>
      <if test="loanage != null">
        loanage = #{loanage,jdbcType=INTEGER},
      </if>
      <if test="ispayoff != null">
        ispayoff = #{ispayoff,jdbcType=CHAR},
      </if>
      <if test="orderno != null">
        orderno = #{orderno,jdbcType=VARCHAR}
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.stuloan.web.mybatis.domain.Loan">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update loan
    set userid = #{userid,jdbcType=VARCHAR},
      loanamount = #{loanamount,jdbcType=DECIMAL},
      isstage = #{isstage,jdbcType=CHAR},
      repayreal = #{repayreal,jdbcType=DECIMAL},
      stagenum = #{stagenum,jdbcType=INTEGER},
      repayyet = #{repayyet,jdbcType=DECIMAL},
      stagenumyet = #{stagenumyet,jdbcType=INTEGER},
      createdate = #{createdate,jdbcType=TIMESTAMP},
      updatedate = #{updatedate,jdbcType=TIMESTAMP},
      state = #{state,jdbcType=CHAR},
      auditid = #{auditid,jdbcType=VARCHAR},
      auditman = #{auditman,jdbcType=VARCHAR},
      auditdate = #{auditdate,jdbcType=TIMESTAMP},
      auditmsg = #{auditmsg,jdbcType=VARCHAR},
      remark = #{remark,jdbcType=VARCHAR},
      loanpurpose = #{loanpurpose,jdbcType=VARCHAR}
      loanage = #{loanage,jdbcType=INTEGER},
      ispayoff = #{ispayoff,jdbcType=CHAR},
      orderno = #{orderno,jdbcType=VARCHAR}
    where id = #{id,jdbcType=VARCHAR}
  </update>
  
  <update id="updatebyorderno"  parameterType="com.stuloan.web.mybatis.domain.Loan">
    update loan set state=#{state}
    <if test="state != 1">
      ,orderno = ''
    </if>
    where orderno=#{orderno}
  </update>
  
  <select id="moneystatistics" parameterType="java.lang.String" resultType="java.util.Map">
    select a.moneydate,a.disburse,b.income
    from
    (select DATE_FORMAT(auditdate,#{format}) as moneydate,sum(loanamount) as disburse
    from loan
    where state='1'
    group by moneydate) a
    left join
    (select DATE_FORMAT(repaydatereal,#{format}) as moneydate,sum(repaymoney) as income
    from repaydetail
    where isrepay='1'
    group by moneydate) b on b.moneydate = a.moneydate
    where 1=1
    <if test="begindate != null and begindate != ''">
      and a.moneydate &gt;= #{begindate}
    </if>
    <if test="enddate != null and enddate != ''">
      and a.moneydate &lt; #{enddate}
    </if>
    order by a.moneydate desc
    <if test="beginRow != null and beginRow != ''">
      limit ${beginRow},${pageSize}
    </if>
  </select>
  <select id="gettotaldisburse" parameterType="java.lang.String" resultType="java.lang.Double">
    select sum(loanamount) from loan where state='1'
    <if test="begindate != null and begindate != ''">
       and DATE_FORMAT(repaydatereal,#{format}) &gt;= #{begindate}
    </if>
    <if test="enddate != null and enddate != ''">
      and DATE_FORMAT(repaydatereal,#{format}) &lt; #{enddate}
    </if>
  </select>
  <select id="gettotalincome" parameterType="java.lang.String" resultType="java.lang.Double">
    select sum(repaymoney) from repaydetail where isrepay='1'
    <if test="begindate != null and begindate != ''">
      and DATE_FORMAT(repaydatereal,#{format}) &gt;= #{begindate}
    </if>
    <if test="enddate != null and enddate != ''">
      and DATE_FORMAT(repaydatereal,#{format}) &lt; #{enddate}
    </if>
  </select>
</mapper>